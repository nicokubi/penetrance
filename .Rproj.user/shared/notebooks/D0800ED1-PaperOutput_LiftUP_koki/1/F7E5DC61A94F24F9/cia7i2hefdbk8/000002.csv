"0","# Supplemental Tables: Age-specific Cumulative Risks"
"0",""
"0","# Function to create a table of age-specific cumulative risks"
"0","create_age_specific_risk_table <- function(data, ages = seq(30, 80, by = 5), sex = ""Female"") {"
"0","  # Calculate Weibull parameters"
"0","  if (sex == ""Female"") {"
"0","    params <- calculate_weibull_parameters("
"0","      data$median_results,"
"0","      data$first_quartile_results,"
"0","      data$threshold_results"
"0","    )"
"0","    "
"0","    alphas <- params$alpha"
"0","    betas <- params$beta"
"0","    thresholds <- data$threshold_results"
"0","    asymptotes <- data$asymptote_results"
"0","  } else if (sex == ""Male"") {"
"0","    params <- calculate_weibull_parameters("
"0","      data$median_male_results,"
"0","      data$first_quartile_male_results,"
"0","      data$threshold_male_results"
"0","    )"
"0","    "
"0","    alphas <- params$alpha"
"0","    betas <- params$beta"
"0","    thresholds <- data$threshold_male_results"
"0","    asymptotes <- data$asymptote_male_results"
"0","  } else {"
"0","    stop(""Invalid sex. Please choose 'Male' or 'Female'."")"
"0","  }"
"0","  "
"0","  # Calculate cumulative risk for each age"
"0","  risk_by_age <- lapply(ages, function(age) {"
"0","    # Calculate risk for each MCMC sample"
"0","    risks <- mapply(function(alpha, beta, threshold, asymptote) {"
"0","      if (age <= threshold) {"
"0","        return(0)"
"0","      } else {"
"0","        return(pweibull(age - threshold, shape = alpha, scale = beta) * asymptote)"
"0","      }"
"0","    }, alphas, betas, thresholds, asymptotes)"
"0","    "
"0","    # Calculate mean and confidence intervals"
"0","    mean_risk <- mean(risks, na.rm = TRUE)"
"0","    ci_lower <- quantile(risks, probs = 0.025, na.rm = TRUE)"
"0","    ci_upper <- quantile(risks, probs = 0.975, na.rm = TRUE)"
"0","    "
"0","    # Return as a list"
"0","    return(list("
"0","      mean = mean_risk,"
"0","      lower = ci_lower,"
"0","      upper = ci_upper"
"0","    ))"
"0","  })"
"0","  "
"0","  # Create a data frame with the results"
"0","  result_df <- data.frame("
"0","    Age = ages,"
"0","    Mean_Risk = sapply(risk_by_age, function(x) x$mean),"
"0","    Lower_CI = sapply(risk_by_age, function(x) x$lower),"
"0","    Upper_CI = sapply(risk_by_age, function(x) x$upper)"
"0","  )"
"0","  "
"0","  return(result_df)"
"0","}"
"0",""
"0","# Create tables for each dataset"
"0","# 1. Original dataset (not removing proband)"
"0","risk_table_original <- create_age_specific_risk_table("
"0","  data = dat_not_remove_proband$combined_chains,"
"0","  ages = seq(30, 80, by = 5),"
"0","  sex = ""Female"""
"0",")"
"0",""
"0","# 2. Dataset with proband removed"
"0","risk_table_removed <- create_age_specific_risk_table("
"0","  data = dat_remove_proband$combined_chains,"
"0","  ages = seq(30, 80, by = 5),"
"0","  sex = ""Female"""
"0",")"
"0",""
"0","# 3. Dataset from 030125"
"0","risk_table_030125 <- create_age_specific_risk_table("
"0","  data = dat_not_remove_proband_030125$combined_chains,"
"0","  ages = seq(30, 80, by = 5),"
"0","  sex = ""Female"""
"0",")"
"0",""
"0","# Format tables with percentages"
"0","format_risk_table <- function(table) {"
"0","  formatted_table <- table"
"0","  formatted_table$Mean_Risk <- paste0(round(table$Mean_Risk * 100, 1), ""%"")"
"0","  formatted_table$Lower_CI <- paste0(round(table$Lower_CI * 100, 1), ""%"")"
"0","  formatted_table$Upper_CI <- paste0(round(table$Upper_CI * 100, 1), ""%"")"
"0","  formatted_table$Risk_with_CI <- paste0("
"0","    formatted_table$Mean_Risk, "" ("", "
"0","    formatted_table$Lower_CI, ""-"", "
"0","    formatted_table$Upper_CI, "")"""
"0","  )"
"0","  return(formatted_table)"
"0","}"
"0",""
"0","# Format all tables"
"0","risk_table_original_formatted <- format_risk_table(risk_table_original)"
"0","risk_table_removed_formatted <- format_risk_table(risk_table_removed)"
"0","risk_table_030125_formatted <- format_risk_table(risk_table_030125)"
"0",""
"0","# Display tables"
"0","cat(""## Cumulative Risk Table - Original Data (with probands)\n"")"
"1","## Cumulative Risk Table - Original Data (with probands)
"
"0","print(knitr::kable("
"0","  risk_table_original_formatted[, c(""Age"", ""Risk_with_CI"")],"
"0","  col.names = c(""Age"", ""Cumulative Risk (95% CI)""),"
"0","  caption = ""Age-specific cumulative risk of ovarian cancer for PALB2 PGV carriers (original data with probands)"""
"0","))"
