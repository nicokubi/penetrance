"0","# 1. Check for completeness and sample size"
"0","completeness_check <- function(dat_adjusted) {"
"0","  # Count individuals by sex and affected status"
"0","  sex_counts <- sapply(dat_adjusted, function(df) {"
"0","    c("
"0","      male_carriers = sum(df$Sex == 1 & df$geno == 1, na.rm = TRUE),"
"0","      female_carriers = sum(df$Sex == 0 & df$geno == 1, na.rm = TRUE),"
"0","      male_affected = sum(df$Sex == 1 & df$isAff == 1, na.rm = TRUE),"
"0","      female_affected = sum(df$Sex == 0 & df$isAff == 1, na.rm = TRUE)"
"0","    )"
"0","  })"
"0","  "
"0","  # Total counts"
"0","  totals <- rowSums(sex_counts)"
"0","  print(""Sample size by sex and status:"")"
"0","  print(totals)"
"0","  "
"0","  # Check if sufficient data in each category"
"0","  if(any(totals < 30)) {"
"0","    warning(""Small sample size in one or more categories"")"
"0","  }"
"0","  "
"0","  return(totals)"
"0","}"
"0",""
"0","# 2. Check for missing data in critical fields"
"0","missing_data_check <- function(dat_adjusted) {"
"0","  missing_counts <- sapply(dat_adjusted, function(df) {"
"0","    c("
"0","      missing_sex = sum(is.na(df$Sex)),"
"0","      missing_geno = sum(is.na(df$geno)),"
"0","      missing_age = sum(is.na(df$Age) & df$isAff == 1),"
"0","      missing_curage = sum(is.na(df$CurAge) & df$isAff == 0)"
"0","    )"
"0","  })"
"0","  "
"0","  total_missing <- rowSums(missing_counts)"
"0","  print(""Missing data counts:"")"
"0","  print(total_missing)"
"0","  "
"0","  return(total_missing)"
"0","}"
"0",""
"0","# 3. Age distribution check for affected individuals"
"0","age_distribution_check <- function(dat_adjusted) {"
"0","  # Extract ages of onset for affected individuals"
"0","  ages_male <- unlist(lapply(dat_adjusted, function(df) {"
"0","    df$Age[df$isAff == 1 & df$Sex == 1]"
"0","  }))"
"0","  "
"0","  ages_female <- unlist(lapply(dat_adjusted, function(df) {"
"0","    df$Age[df$isAff == 1 & df$Sex == 0]"
"0","  }))"
"0","  "
"0","  # Basic summary statistics"
"0","  male_summary <- summary(ages_male)"
"0","  female_summary <- summary(ages_female)"
"0","  "
"0","  print(""Age of onset summary - Males:"")"
"0","  print(male_summary)"
"0","  print(""Age of onset summary - Females:"")"
"0","  print(female_summary)"
"0","  "
"0","  # Check for implausible values"
"0","  if(min(ages_male, na.rm = TRUE) < 10 || min(ages_female, na.rm = TRUE) < 10) {"
"0","    warning(""Very early onset detected - verify these cases"")"
"0","  }"
"0","  "
"0","  return(list(male = male_summary, female = female_summary))"
"0","}"
"0",""
"0","# 4. Check for ascertainment bias - CORRECTED VERSION"
"0","ascertainment_check <- function(dat_adjusted) {"
"0","  # Count probands and non-probands"
"0","  proband_counts <- sapply(dat_adjusted, function(df) {"
"0","    c("
"0","      probands = sum(df$isProband == 1, na.rm = TRUE),"
"0","      non_probands = sum(df$isProband == 0, na.rm = TRUE)"
"0","    )"
"0","  })"
"0","  "
"0","  total_counts <- rowSums(proband_counts)"
"0","  proband_ratio <- total_counts[""probands""] / sum(total_counts)"
"0","  "
"0","  print(""Proband to non-proband ratio:"")"
"0","  print(proband_ratio)"
"0","  "
"0","  # Compare age distribution in probands vs. non-probands"
"0","  ages_proband <- unlist(lapply(dat_adjusted, function(df) {"
"0","    df$Age[df$isAff == 1 & df$isProband == 1 & df$geno == 1]"
"0","  }))"
"0","  "
"0","  ages_nonproband <- unlist(lapply(dat_adjusted, function(df) {"
"0","    df$Age[df$isAff == 1 & df$isProband == 0 & df$geno == 1]"
"0","  }))"
"0","  "
"0","  # Use separate print statements"
"0","  cat(""Mean age - Probands: "", mean(ages_proband, na.rm = TRUE), ""\n"")"
"0","  cat(""Mean age - Non-probands: "", mean(ages_nonproband, na.rm = TRUE), ""\n"")"
"0","  "
"0","  return(abs(mean(ages_proband, na.rm = TRUE) - mean(ages_nonproband, na.rm = TRUE)))"
"0","}"
"0",""
"0","# 5. Generate histograms for age distribution"
"0","age_histograms <- function(dat_adjusted) {"
"0","  # Extract data for different groups"
"0","  # 1. Proband carriers"
"0","  ages_proband_carriers <- unlist(lapply(dat_adjusted, function(df) {"
"0","    df$Age[df$isAff == 1 & df$isProband == 1 & df$geno == 1]"
"0","  }))"
"0","  "
"0","  # 2. Proband non-carriers"
"0","  ages_proband_noncarriers <- unlist(lapply(dat_adjusted, function(df) {"
"0","    df$Age[df$isAff == 1 & df$isProband == 1 & df$geno == 0]"
"0","  }))"
"0","  "
"0","  # 3. Non-proband carriers"
"0","  ages_nonproband_carriers <- unlist(lapply(dat_adjusted, function(df) {"
"0","    df$Age[df$isAff == 1 & df$isProband == 0 & df$geno == 1]"
"0","  }))"
"0","  "
"0","  # 4. Non-proband non-carriers"
"0","  ages_nonproband_noncarriers <- unlist(lapply(dat_adjusted, function(df) {"
"0","    df$Age[df$isAff == 1 & df$isProband == 0 & df$geno == 0]"
"0","  }))"
"0","  "
"0","  # Set up a plotting area with 2 rows and 1 column"
"0","  par(mfrow = c(2, 1))"
"0","  "
"0","  # Define common bins for consistent comparison"
"0","  all_ages <- c(ages_proband_carriers, ages_proband_noncarriers, "
"0","                ages_nonproband_carriers, ages_nonproband_noncarriers)"
"0","  age_range <- range(all_ages, na.rm = TRUE)"
"0","  bins <- seq(floor(age_range[1]), ceiling(age_range[2]), by = 2)  # 2-year bins"
"0","  "
"0","  # Plot 1: Histogram for probands (carriers vs non-carriers)"
"0","  hist_colors <- c(""darkgreen"", ""lightgreen"")"
"0","  "
"0","  # Create histograms with transparent fill"
"0","  hist(ages_proband_carriers, "
"0","       breaks = bins,"
"0","       col = adjustcolor(hist_colors[1], alpha.f = 0.7),"
"0","       border = ""darkgreen"","
"0","       main = ""Age of Onset - Probands by Carrier Status"","
"0","       xlab = ""Age"", "
"0","       ylab = ""Frequency"","
"0","       xlim = age_range)"
"0","  "
"0","  # Add non-carriers histogram"
"0","  hist(ages_proband_noncarriers,"
"0","       breaks = bins,"
"0","       col = adjustcolor(hist_colors[2], alpha.f = 0.7),"
"0","       border = ""darkgreen"","
"0","       add = TRUE)"
"0","  "
"0","  # Add legend"
"0","  legend(""topright"", "
"0","         legend = c(""Carriers"", ""Non-carriers""), "
"0","         fill = hist_colors, "
"0","         border = ""darkgreen"","
"0","         bty = ""n"")"
"0","  "
"0","  # Plot 2: Histogram for non-probands (carriers vs non-carriers)"
"0","  hist_colors <- c(""darkblue"", ""lightblue"")"
"0","  "
"0","  # Create histograms with transparent fill"
"0","  hist(ages_nonproband_carriers, "
"0","       breaks = bins,"
"0","       col = adjustcolor(hist_colors[1], alpha.f = 0.7),"
"0","       border = ""darkblue"","
"0","       main = ""Age of Onset - Non-Probands by Carrier Status"","
"0","       xlab = ""Age"", "
"0","       ylab = ""Frequency"","
"0","       xlim = age_range)"
"0","  "
"0","  # Add non-carriers histogram"
"0","  hist(ages_nonproband_noncarriers,"
"0","       breaks = bins,"
"0","       col = adjustcolor(hist_colors[2], alpha.f = 0.7),"
"0","       border = ""darkblue"","
"0","       add = TRUE)"
"0","  "
"0","  # Add legend"
"0","  legend(""topright"", "
"0","         legend = c(""Carriers"", ""Non-carriers""), "
"0","         fill = hist_colors, "
"0","         border = ""darkblue"","
"0","         bty = ""n"")"
"0","  "
"0","  # Reset plotting parameters"
"0","  par(mfrow = c(1, 1))"
"0","  "
"0","  # Return counts for each group"
"0","  return(list("
"0","    proband_carriers = length(ages_proband_carriers),"
"0","    proband_noncarriers = length(ages_proband_noncarriers),"
"0","    nonproband_carriers = length(ages_nonproband_carriers),"
"0","    nonproband_noncarriers = length(ages_nonproband_noncarriers)"
"0","  ))"
"0","}"
"0",""
"0","# Update the run_all_checks function to include histograms"
"0","run_all_checks <- function(dat_adjusted) {"
"0","  results <- list()"
"0","  "
"0","  cat(""--------- COMPLETENESS CHECK ---------\n"")"
"0","  results$completeness <- completeness_check(dat_adjusted)"
"0","  "
"0","  cat(""\n--------- MISSING DATA CHECK ---------\n"")"
"0","  results$missing <- missing_data_check(dat_adjusted)"
"0","  "
"0","  cat(""\n--------- AGE DISTRIBUTION CHECK ---------\n"")"
"0","  results$age_dist <- age_distribution_check(dat_adjusted)"
"0","  "
"0","  cat(""\n--------- ASCERTAINMENT BIAS CHECK ---------\n"")"
"0","  results$ascertainment <- ascertainment_check(dat_adjusted)"
"0","  "
"0","  cat(""\n--------- GENERATING HISTOGRAMS ---------\n"")"
"0","  results$histograms <- age_histograms(dat_adjusted)"
"0","  cat(""Group counts:\n"")"
"0","  print(results$histograms)"
"0","  "
"0","  return(results)"
"0","}"
"0",""
"0","# Execute all checks including histograms"
"0","check_results <- run_all_checks(dat_adjusted)"
"1","--------- COMPLETENESS CHECK ---------
"
"1","[1]"
"1"," ""Sample size by sex and status:"""
"1","
"
"1","  male_carriers "
"1","female_carriers "
"1","  male_affected "
"1","female_affected "
"1","
"
"1","           1301 "
"1","           2381 "
"1","            314 "
"1","            271 "
"1","
"
"1","
--------- MISSING DATA CHECK ---------
"
"1","[1]"
"1"," ""Missing data counts:"""
"1","
"
"1","   missing_sex "
"1","  missing_geno "
"1","   missing_age "
"1","missing_curage "
"1","
"
"1","          2004 "
"1","         62344 "
"1","             0 "
"1","         37365 "
"1","
"
"1","
--------- AGE DISTRIBUTION CHECK ---------
"
"1","[1]"
"1"," ""Age of onset summary - Males:"""
"1","
"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","   NA's "
"1","
"
"1","  12.00 "
"1","  45.00 "
"1","  55.50 "
"1","  55.47 "
"1","  68.00 "
"1","  90.00 "
"1","      1 "
"1","
"
"1","[1]"
"1"," ""Age of onset summary - Females:"""
"1","
"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","   NA's "
"1","
"
"1","   9.00 "
"1","  40.50 "
"1","  55.00 "
"1","  53.66 "
"1","  67.00 "
"1","  90.00 "
"1","      1 "
"1","
"
"2","Warning in age_distribution_check(dat_adjusted) :"
"2","
 "
"2"," Very early onset detected - verify these cases
"
"1","
--------- ASCERTAINMENT BIAS CHECK ---------
"
"1","[1]"
"1"," ""Proband to non-proband ratio:"""
"1","
"
"1"," probands "
"1","
"
"1","0.7418066 "
"1","
"
"1","Mean age - Probands: "
"1"," "
"1","39.7377"
"1"," "
"1","
"
"1","Mean age - Non-probands: "
"1"," "
"1","36"
"1"," "
"1","
"
"1","
--------- GENERATING HISTOGRAMS ---------
"
"1","Group counts:
"
"1","$proband_carriers
"
"1","[1]"
"1"," 557"
"1","
"
"1","
"
"1","$proband_noncarriers
"
"1","[1]"
"1"," 450"
"1","
"
"1","
"
"1","$nonproband_carriers
"
"1","[1]"
"1"," 506"
"1","
"
"1","
"
"1","$nonproband_noncarriers
"
"1","[1]"
"1"," 445"
"1","
"
"1","
"
