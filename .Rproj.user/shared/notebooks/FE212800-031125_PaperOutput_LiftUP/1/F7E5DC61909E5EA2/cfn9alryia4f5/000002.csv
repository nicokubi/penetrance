"0","# Load the necessary packages if they're not already loaded"
"0","if (!requireNamespace(""survminer"", quietly = TRUE)) {"
"0","  install.packages(""survminer"")"
"0","}"
"0","library(survminer)"
"0","library(survival)"
"0","library(dplyr)"
"0","library(ggplot2)"
"0",""
"0","# Function to extract and prepare data for Kaplan-Meier analysis"
"0","prepare_km_data <- function(pedigree_list) {"
"0","  # Combine all pedigrees into a single dataframe"
"0","  all_data <- do.call(rbind, pedigree_list)"
"0","  "
"0","  # Filter for carriers only (geno == 1) and remove probands if needed"
"0","  km_data <- all_data %>%"
"0","    filter(geno == 1)"
"0","    #filter(isProband != 1)  # Remove probands"
"0","  "
"0","  # Create a survival object"
"0","  # For affected individuals: event = 1, time = Age at diagnosis"
"0","  # For unaffected individuals: event = 0, time = CurAge (current age)"
"0","  km_data$event <- km_data$isAff"
"0","  km_data$time <- ifelse(km_data$isAff == 1, km_data$Age, km_data$CurAge)"
"0","  "
"0","  # Remove entries with missing time"
"0","  km_data <- km_data %>% filter(!is.na(time))"
"0","  "
"0","  return(km_data)"
"0","}"
"0",""
"0","# Prepare data for Kaplan-Meier analysis"
"0","km_data <- prepare_km_data(dat_adjusted)"
"0",""
"0","# Create overall Kaplan-Meier curve"
"0","km_fit <- survfit(Surv(time, event) ~ 1, data = km_data)"
"0",""
"0","# Plot overall penetrance curve (1 - survival)"
"0","p1 <- ggsurvplot("
"0","  km_fit,"
"0","  data = km_data,"
"0","  fun = function(y) 1-y,  # Convert survival to penetrance"
"0","  conf.int = TRUE,"
"0","  risk.table = TRUE,"
"0","  ggtheme = theme_minimal(),"
"0","  palette = ""lancet"","
"0","  title = ""TP53 Penetrance for Colorectal Cancer"","
"0","  xlab = ""Age (years)"","
"0","  ylab = ""Cumulative Penetrance"","
"0","  legend.title = """","
"0","  legend.labs = ""Overall"""
"0",")"
"0",""
"0","# Create sex-specific Kaplan-Meier curves"
"0","km_fit_sex <- survfit(Surv(time, event) ~ factor(Sex), data = km_data)"
"0",""
"0","# Plot sex-specific penetrance curves"
"0","p2 <- ggsurvplot("
"0","  km_fit_sex,"
"0","  data = km_data,"
"0","  fun = function(y) 1-y,  # Convert survival to penetrance"
"0","  conf.int = TRUE,"
"0","  risk.table = TRUE,"
"0","  xlim = c(0, 65),"
"0","  ylim = c(0,0.25),"
"0","  break.x.by = 10,"
"0","  ggtheme = theme_minimal(),"
"0","  palette = c(""#E7B800"", ""#2E9FDF""),"
"0","  title = ""Sex-specific TP53 Penetrance for Colorectal Cancer"","
"0","  xlab = ""Age (years)"","
"0","  ylab = ""Cumulative Penetrance"","
"0","  legend.title = ""Sex"","
"0","  legend.labs = c(""Female"", ""Male"")"
"0",")"
"0",""
"0","# Print the plots"
"0","print(p1)"
