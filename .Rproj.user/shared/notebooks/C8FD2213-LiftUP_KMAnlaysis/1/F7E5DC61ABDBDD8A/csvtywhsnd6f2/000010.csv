"0","plot_penetrance_curves <- function(fams, remove_proband = FALSE) {"
"0","  "
"0","  # Aggregate the data"
"0","  allcarriers <- do.call(rbind, fams)"
"0","  "
"0","  # Set Age to CurAge if not affected (isAff == 0)"
"0","  allcarriers$Age <- ifelse(allcarriers$isAff == 0, allcarriers$CurAge, allcarriers$Age)"
"0","  "
"0","  # Remove rows with NA in Age or isAff"
"0","  allcarriers <- allcarriers[!is.na(allcarriers$Age) & !is.na(allcarriers$isAff), ]"
"0","  "
"0","  # Optionally remove probands (isProband == 1)"
"0","  if (remove_proband) {"
"0","    allcarriers <- allcarriers[allcarriers$isProband == 0, ]"
"0","  }"
"0","  "
"0","  # Convert isAff to numeric (0 or 1)"
"0","  allcarriers$isAff <- as.numeric(allcarriers$isAff)"
"0","  "
"0","  # Separate data by gender (assuming Sex: 0 = female, 1 = male)"
"0","  female_data <- allcarriers[allcarriers$Sex == 0, ]"
"0","  male_data <- allcarriers[allcarriers$Sex == 1, ]"
"0","  "
"0","  # Set the plot title based on the `remove_proband` flag"
"0","  plot_title <- if (remove_proband) {"
"0","    ""Kaplan-Meier Curves for CRC (Without Probands)"""
"0","  } else {"
"0","    ""Kaplan-Meier Curves for CRC (With Probands)"""
"0","  }"
"0","  "
"0","  # Set up the plotting area for both genders"
"0","  plot(0, 0, type = ""n"", xlim = c(0, 100), ylim = c(0, 0.2), xlab = ""Age"", "
"0","       ylab = ""Penetrance"", main = plot_title)"
"0","  "
"0","  # Initialize colors and line types"
"0","  colors <- c(""red"", ""blue"")  "
"0","  line_types <- c(1, 1)  "
"0",""
"0","  # Kaplan-Meier for females"
"0","  surv_obj_female <- Surv(time = female_data$Age, event = female_data$isAff)"
"0","  km_fit_female <- survfit(surv_obj_female ~ 1, data = female_data)"
"0","  penetrance_female <- 1 - km_fit_female$surv"
"0","  "
"0","  # Plot the aggregated penetrance curves for females"
"0","  lines(km_fit_female$time, penetrance_female, type = ""l"", col = colors[1], lty = line_types[1])"
"0","  "
"0","  # Kaplan-Meier for males"
"0","  surv_obj_male <- Surv(time = male_data$Age, event = male_data$isAff)"
"0","  km_fit_male <- survfit(surv_obj_male ~ 1, data = male_data)"
"0","  penetrance_male <- 1 - km_fit_male$surv"
"0","  "
"0","  # Plot the aggregated penetrance curves for males"
"0","  lines(km_fit_male$time, penetrance_male, type = ""l"", col = colors[2], lty = line_types[1])"
"0","  "
"0","  # Extract affected and non-affected counts from the survfit objects"
"0","  num_affected_female <- sum(km_fit_female$n.event)"
"0","  num_non_affected_female <- km_fit_female$n[1] - num_affected_female"
"0","  "
"0","  num_affected_male <- sum(km_fit_male$n.event)"
"0","  num_non_affected_male <- km_fit_male$n[1] - num_affected_male"
"0",""
"0","  # Print the counts"
"0","  message(paste(""Females - Affected:"", num_affected_female, "", Non-Affected:"", num_non_affected_female))"
"0","  message(paste(""Males - Affected:"", num_affected_male, "", Non-Affected:"", num_non_affected_male))"
"0","  "
"0","  # Add legend to distinguish between male and female curves"
"0","  legend(""topleft"", legend = c(""Females"", ""Males""), col = colors, lty = line_types, bty = ""n"")"
"0","}"
"0",""
"0","# Usage with or without removing probands"
"0","plot_penetrance_curves(dat_adjusted, remove_proband = TRUE)"
"2","Females - Affected: 151 , Non-Affected: 3177
"
"2","Males - Affected: 183 , Non-Affected: 3257
"
