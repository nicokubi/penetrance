"0","# Define sample sizes"
"0","sample_sizes <- c(30, 130, 400, 1000)"
"0",""
"0","# Set seed for reproducibility"
"0","set.seed(2024)"
"0",""
"0","# Simulation for each sample size"
"0","message(""Running simulations for each sample size..."")"
"2","Running simulations for each sample size...
"
"0","sim_sets <- vector(""list"", length(sample_sizes))"
"0","names(sim_sets) <- paste0(""fam"", sample_sizes)"
"0",""
"0","for (i in seq_along(sample_sizes)) {"
"0","  size <- sample_sizes[i]"
"0","  set_name <- paste0(""fam"", size)"
"0",""
"0","  # Set seed for reproducibility, but different for each sample size"
"0","  set.seed(2024 + i)"
"0",""
"0","  message(paste0(""\nSimulating for sample size "", size, ""...""))"
"0",""
"0","  # Calculate how many families we need to simulate to get enough carrier probands"
"0","  # Assuming ~10% carrier rate among probands based on gene frequency"
"0","  target_families <- ceiling(size / 0.1)"
"0",""
"0","  # Simulate families"
"0","  sim_result <- try(simulateFamilies(numberFamilies = target_families, gene_freq = 0.1), silent = TRUE)"
"0",""
"0","  if (!inherits(sim_result, ""try-error"")) {"
"0","    # Process the simulation results"
"0","    masked_families <- processSimulation(sim_result)"
"0","    message(paste0(""Generated "", length(masked_families), "" families with carrier probands""))"
"0",""
"0","    # If we don't have enough families, try another round"
"0","    while (length(masked_families) < size) {"
"0","      message(""Not enough carrier families. Running additional simulation..."")"
"0","      additional_sim <- try(simulateFamilies(numberFamilies = target_families, gene_freq = 0.1), silent = TRUE)"
"0","      if (!inherits(additional_sim, ""try-error"")) {"
"0","        additional_masked <- processSimulation(additional_sim)"
"0","        masked_families <- c(masked_families, additional_masked)"
"0","      }"
"0","    }"
"0",""
"0","    # Select exactly the number we need"
"0","    if (length(masked_families) > size) {"
"0","      masked_families <- masked_families[1:size]"
"0","    }"
"0",""
"0","    # Store the families"
"0","    sim_sets[[set_name]] <- masked_families"
"0",""
"0","    # Save this sample"
"0","    sample_data <- masked_families"
"0","    save(sample_data, file = file.path(results_dir, paste0(""sample_"", size, ""_panelpro.RData"")))"
"0","    message(paste0(""Saved sample of size "", size))"
"0",""
"0","    # Reformat the data"
"0","    reformatted_data <- reformatFamilies(masked_families)"
"0","    save(reformatted_data, file = file.path(results_dir, paste0(""reformatted_"", size, "".RData"")))"
"0","    message(paste0(""Saved reformatted data for sample size "", size))"
"0","  } else {"
"0","    message(paste0(""Error in simulation for sample size "", size))"
"0","  }"
"0","}"
"2","
Simulating for sample size 30...
"
"2","Generated 58 families with carrier probands
"
"2","Saved sample of size 30
"
"2","Saved reformatted data for sample size 30
"
"2","
Simulating for sample size 130...
"
"2","Generated 264 families with carrier probands
"
"2","Saved sample of size 130
"
"2","Saved reformatted data for sample size 130
"
"2","
Simulating for sample size 400...
"
"2","Generated 726 families with carrier probands
"
"2","Saved sample of size 400
"
"2","Saved reformatted data for sample size 400
"
"2","
Simulating for sample size 1000...
"
"2","Generated 1977 families with carrier probands
"
"2","Saved sample of size 1000
"
"2","Saved reformatted data for sample size 1000
"
"0","# Verify the number of families in each set"
"0","for (i in seq_along(sample_sizes)) {"
"0","  size <- sample_sizes[i]"
"0","  set_name <- paste0(""fam"", size)"
"0","  cat(paste0(set_name, "": "", length(sim_sets[[set_name]]), "" families\n""))"
"0","}"
"1","fam30: 30 families
"
"1","fam130: 130 families
"
"1","fam400: 400 families
"
"1","fam1000: 1000 families
"
