"0","# Function to prepare data for Kaplan-Meier analysis"
"0","prepareKaplanMeier <- function(families) {"
"0","  all_data <- do.call(rbind, families)"
"0","  all_data$gender <- factor(all_data$Sex, levels = c(1, 2), labels = c(""Male"", ""Female""))"
"0","  all_data$carrier <- factor(all_data$geno,"
"0","    levels = c(0, 1, NA),"
"0","    labels = c(""Non-Carrier"", ""Carrier"", ""Unknown"")"
"0","  )"
"0","  return(all_data)"
"0","}"
"0",""
"0","# Function to plot penetrance curves from KM estimates"
"0","plot_penetrance_curves <- function(km_fit, title) {"
"0","  surv_data <- data.frame("
"0","    time = km_fit$time,"
"0","    penetrance = 1 - km_fit$surv,"
"0","    strata = rep(names(km_fit$strata), km_fit$strata)"
"0","  )"
"0",""
"0","  ggplot(surv_data, aes(x = time, y = penetrance, color = strata)) +"
"0","    geom_step(size = 1.2) +"
"0","    labs("
"0","      x = ""Age"","
"0","      y = ""Cumulative Risk (Penetrance)"","
"0","      color = ""Group"","
"0","      title = title"
"0","    ) +"
"0","    theme_minimal() +"
"0","    theme("
"0","      plot.title = element_text(size = 14, face = ""bold""),"
"0","      legend.position = ""bottom"""
"0","    ) +"
"0","    scale_y_continuous("
"0","      limits = c(0, 1),"
"0","      labels = scales::percent_format(accuracy = 1)"
"0","    )"
"0","}"
"0",""
"0","# Plot curves for each sample size"
"0","for (size in sample_sizes) {"
"0","  data_file <- file.path(results_dir, paste0(""reformatted_"", size, "".RData""))"
"0","  if (file.exists(data_file)) {"
"0","    load(data_file)"
"0","    km_data <- prepareKaplanMeier(formatted_data)"
"0","    "
"0","    # Fit and plot Kaplan-Meier models"
"0","    km_fit_carrier <- survfit(Surv(Age, status = isAff) ~ carrier, data = km_data)"
"0","    km_fit_gender <- survfit(Surv(Age, status = isAff) ~ carrier + gender, data = km_data)"
"0",""
"0","    p1 <- plot_penetrance_curves(km_fit_carrier, paste0(""By Carrier Status (n="", size, "")""))"
"0","    p2 <- plot_penetrance_curves(km_fit_gender, paste0(""By Carrier Status and Gender (n="", size, "")""))"
"0","    "
"0","    gridExtra::grid.arrange(p1, p2, ncol = 2)"
"0","  }"
"0","}"
"2","Error in prepareKaplanMeier(formatted_data) : 
  object 'formatted_data' not found
"
