"0","# Prepare data for Kaplan-Meier analysis"
"0","prepareKaplanMeier <- function(families) {"
"0","  all_data <- do.call(rbind, families)"
"0","  all_data$gender <- factor(all_data$Sex, levels = c(1, 2), labels = c(""Male"", ""Female""))"
"0","  # First, create the factor for non-missing values"
"0","  all_data$carrier <- factor(all_data$geno, levels = c(0, 1), labels = c(""Non-Carrier"", ""Carrier""))"
"0","  # Then assign ""Unknown"" for missing genotype values"
"0","  all_data$carrier[is.na(all_data$geno)] <- ""Unknown"""
"0","  return(all_data)"
"0","}"
"0",""
"0","plot_penetrance_curves <- function(km_fit, title) {"
"0","  # If km_fit$strata is NULL or has length zero, assign a default group"
"0","  if (is.null(km_fit$strata) || length(km_fit$strata) == 0) {"
"0","    strata <- rep(""All"", length(km_fit$time))"
"0","  } else {"
"0","    strata <- rep(names(km_fit$strata), km_fit$strata)"
"0","  }"
"0","  "
"0","  surv_data <- data.frame("
"0","    time = km_fit$time,"
"0","    penetrance = 1 - km_fit$surv,"
"0","    strata = strata"
"0","  )"
"0","  "
"0","  ggplot(surv_data, aes(x = time, y = penetrance, color = strata)) +"
"0","    geom_step(size = 1.2) +"
"0","    labs("
"0","      x = ""Age"","
"0","      y = ""Cumulative Risk (Penetrance)"","
"0","      color = ""Group"","
"0","      title = title"
"0","    ) +"
"0","    theme_minimal() +"
"0","    theme("
"0","      plot.title = element_text(size = 14, face = ""bold""),"
"0","      legend.position = ""bottom"""
"0","    ) +"
"0","    scale_y_continuous("
"0","      limits = c(0, 1),"
"0","      labels = scales::percent_format(accuracy = 1)"
"0","    )"
"0","}"
"0",""
"0",""
"0","# Plot curves for each sample size using reformatted data from results_dir"
"0","for (size in sample_sizes) {"
"0","  data_file <- file.path(results_dir, paste0(""reformatted_"", size, "".RData""))"
"0","  if (file.exists(data_file)) {"
"0","    load(data_file)  # loads 'reformatted_data'"
"0","    km_data <- prepareKaplanMeier(reformatted_data)"
"0","    "
"0","    # Fit Kaplan-Meier models"
"0","    km_fit_carrier <- survfit(Surv(Age, isAff) ~ carrier, data = km_data)"
"0","    km_fit_gender <- survfit(Surv(Age, isAff) ~ carrier + gender, data = km_data)"
"0","    "
"0","    p1 <- plot_penetrance_curves(km_fit_carrier, paste0(""By Carrier Status (n="", size, "")""))"
"0","    p2 <- plot_penetrance_curves(km_fit_gender, paste0(""By Carrier Status and Gender (n="", size, "")""))"
"0","    "
"0","    gridExtra::grid.arrange(p1, p2, ncol = 2)"
"0","  }"
"0","}"
"2","Warning in `[<-.factor`(`*tmp*`, is.na(all_data$geno), value = ""Unknown"") :"
"2","
 "
"2"," invalid factor level, NA generated
"
"2","Warning in `[<-.factor`(`*tmp*`, is.na(all_data$geno), value = ""Unknown"") :"
"2","
 "
"2"," invalid factor level, NA generated
"
"2","Warning in `[<-.factor`(`*tmp*`, is.na(all_data$geno), value = ""Unknown"") :"
"2","
 "
"2"," invalid factor level, NA generated
"
"2","Warning in `[<-.factor`(`*tmp*`, is.na(all_data$geno), value = ""Unknown"") :"
"2","
 "
"2"," invalid factor level, NA generated
"
