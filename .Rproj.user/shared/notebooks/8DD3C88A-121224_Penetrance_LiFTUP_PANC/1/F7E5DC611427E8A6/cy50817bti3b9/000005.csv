"0","process_pedigree_data <- function(dat) {"
"0","    ###########################################"
"0","    # USER CONFIGURATION - MODIFY AS NEEDED"
"0","    ###########################################"
"0","    "
"0","    # Age boundaries"
"0","    AGE_MIN <- 1    # Minimum valid age"
"0","    AGE_MAX <- 94   # Maximum valid age"
"0","    "
"0","    # Column name mapping - modify if your input data has different column names"
"0","    col_mapping <- c("
"0","        ""Pedigreename"" = ""PedigreeID"","
"0","        ""PedigreeIndividualID"" = ""ID"","
"0","        ""Gender"" = ""Sex"","
"0","        ""PedigreeMotherID"" = ""MotherID"","
"0","        ""PedigreeFatherID"" = ""FatherID"","
"0","        ""probandflag"" = ""isProband"","
"0","        ""Pancreatic"" = ""isAff"",           # Change this for different cancer types"
"0","        ""Pancreatic_AgeDx"" = ""Age"",       # Change this for different cancer types"
"0","        ""GT.Pos"" = ""geno"""
"0","    )"
"0","    "
"0","    ###########################################"
"0","    # HELPER FUNCTIONS - DO NOT MODIFY"
"0","    ###########################################"
"0","    "
"0","    constrain_age <- function(age, min_age = AGE_MIN, max_age = AGE_MAX) {"
"0","        ifelse(age > max_age, max_age,"
"0","               ifelse(age < min_age, min_age, age))"
"0","    }"
"0","    "
"0","    stats <- list("
"0","        removed_sex = 0,"
"0","        invalid_age = 0,"
"0","        na_cur_age = 0"
"0","    )"
"0","    "
"0","    ###########################################"
"0","    # MAIN PROCESSING LOGIC"
"0","    ###########################################"
"0","    "
"0","    dat_processed <- lapply(dat, function(df) {"
"0","        # Rename columns"
"0","        for (old_name in names(col_mapping)) {"
"0","            if (old_name %in% colnames(df)) {"
"0","                colnames(df)[colnames(df) == old_name] <- col_mapping[old_name]"
"0","            }"
"0","        }"
"0","        "
"0","        # Replace CurAge calculation "
"0","        df$CurAge <- ifelse(!is.na(df$ImputedMortAge), "
"0","                           df$ImputedMortAge,"
"0","                           df$WorkingCensorAge)"
"0","        "
"0","        # Keep the age constraints"
"0","        df$CurAge <- constrain_age(df$CurAge)"
"0","        "
"0","        # Process Sex"
"0","        initial_rows <- nrow(df)"
"0","        df$Sex <- ifelse(df$Sex == ""M"", 1, ifelse(df$Sex == ""F"", 0, NA))"
"0","        stats$removed_sex <<- stats$removed_sex + (initial_rows - nrow(df))"
"0","        "
"0","        # Process binary columns"
"0","        df$isProband <- ifelse(df$isProband == ""proband"", 1, 0)"
"0","        df$isAff[is.na(df$isAff)] <- 0"
"0","        df$isAff <- ifelse(df$isAff == ""True"", 1, 0)"
"0","        df$geno <- ifelse(df$geno == ""True"", 1,"
"0","                         ifelse(df$geno == ""False"", 0, NA))"
"0","        "
"0","        # Process ages"
"0","        df$CurAge <- constrain_age(df$CurAge)"
"0","        df$Age <- constrain_age(df$Age)"
"0","        "
"0","        # Update isAff based on Age"
"0","        df$isAff <- ifelse(!is.na(df$Age) & df$Age > 0, 1, df$isAff)"
"0","        "
"0","        # Validate parent IDs"
"0","        valid_ids <- df$ID"
"0","        df$FatherID <- ifelse(df$FatherID %in% valid_ids, df$FatherID, NA)"
"0","        df$MotherID <- ifelse(df$MotherID %in% valid_ids, df$MotherID, NA)"
"0","        "
"0","        # Handle invalid ages for affected individuals"
"0","        df$Age[df$isAff == 1 & (is.na(df$Age) | df$Age < AGE_MIN | df$Age > AGE_MAX)] <- NA"
"0","        "
"0","        # Count NA in CurAge"
"0","        stats$na_cur_age <<- stats$na_cur_age + sum(is.na(df$CurAge))"
"0","        "
"0","        # Check for duplicate IDs within this family"
"0","        duplicate_ids <- df$ID[duplicated(df$ID)]"
"0","        if (length(duplicate_ids) > 0) {"
"0","            warning(sprintf(""Family %s has duplicate IDs: %s"", "
"0","                          df$PedigreeID[1], "
"0","                          paste(duplicate_ids, collapse="", "")))"
"0","        }"
"0","        "
"0","        return(df)"
"0","    })"
"0","    "
"0","    # Add duplicate count to statistics"
"0","    stats$families_with_duplicates <- sum(sapply(dat_processed, function(df) {"
"0","        any(duplicated(df$ID))"
"0","    }))"
"0","    "
"0","    list("
"0","        processed_data = dat_processed,"
"0","        statistics = stats"
"0","    )"
"0","}"
"0",""
"0","# Usage"
"0","result <- process_pedigree_data(dat)"
"0","dat_adjusted <- result$processed_data"
"0",""
"0","# Print statistics"
"0","cat(sprintf(""Total individuals removed due to missing Sex: %d\n"", result$statistics$removed_sex))"
"1","Total individuals removed due to missing Sex: 0
"
"0","cat(sprintf(""Total NA values in CurAge: %d\n"", result$statistics$na_cur_age))"
"1","Total NA values in CurAge: 25008
"
"0","cat(sprintf(""Families with duplicate IDs: %d\n"", result$statistics$families_with_duplicates))"
"1","Families with duplicate IDs: 0
"
"0","save(dat_adjusted, file=""/Users/nicolaskubista/Partners HealthCare Dropbox/BayesMendel/Projects/Active/LiFTUP/Data/PumpkinSpice/processed_pedigree_data_PANC.RData"")"
"0",""
"0",""
"0","describeFamilies(dat_adjusted)"
"1","[1]"
"1"," ""Number of families: 1750"""
"1","
"
"1","[1]"
"1"," ""Total Individuals: 51831"""
"1","
"
"1","[1]"
"1"," ""Average family size: 29.6177142857143"""
"1","
"
"1","[1]"
"1"," ""Summary of family sizes"""
"1","
"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","   1.00 "
"1","   8.00 "
"1","  24.00 "
"1","  29.62 "
"1","  43.00 "
"1"," 332.00 "
"1","
"
"1","[1]"
"1"," ""Summary of Current Age for all family members"""
"1","
"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","   NA's "
"1","
"
"1","   1.00 "
"1","  28.00 "
"1","  46.00 "
"1","  46.07 "
"1","  65.00 "
"1","  94.00 "
"1","  23895 "
"1","
"
"1","[1]"
"1"," ""Number of individuals with NA Current Age (Male): 12255"""
"1","
"
"1","[1]"
"1"," ""Number of individuals with NA Current Age (Female): 11640"""
"1","
"
"1","[1]"
"1"," ""Summary of Current Age for probands"""
"1","
"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","   NA's "
"1","
"
"1","   1.00 "
"1","  24.00 "
"1","  36.00 "
"1","  35.38 "
"1","  47.00 "
"1","  90.00 "
"1","      8 "
"1","
"
"1","[1]"
"1"," ""Number of affected individuals:203"""
"1","
"
"1","[1]"
"1"," ""Number of families with affected individuals: 178"""
"1","
"
"1","[1]"
"1"," ""Number of families with more than 1 affected individual: 21"""
"1","
"
"1","[1]"
"1"," ""Number of families with affected probands: 20"""
"1","
"
"1","[1]"
"1"," ""Number of families with affected female probands: 11"""
"1","
"
"1","[1]"
"1"," ""Number of families with affected male probands: 9"""
"1","
"
"1","[1]"
"1"," ""Number of families with relatives with PV (and not the proband): 664"""
"1","
"
"1","[1]"
"1"," ""Number of probands with PV: 1392"""
"1","
"
"1","[1]"
"1"," ""Number of female probands with PV: 11"""
"1","
"
"1","[1]"
"1"," ""Number of male probands with PV: 8"""
"1","
"
"1","[1]"
"1"," ""Number of individuals with PV: 43"""
"1","
"
"1","[1]"
"1"," ""Summary of Cancer Age of females (excl. probands)"""
"1","
"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","   NA's "
"1","
"
"1","  26.00 "
"1","  52.00 "
"1","  60.00 "
"1","  59.53 "
"1","  70.00 "
"1","  89.00 "
"1","     15 "
"1","
"
"1","[1]"
"1"," ""Summary of Cancer Age of males (excl. probands)"""
"1","
"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","   NA's "
"1","
"
"1","   16.0 "
"1","   50.0 "
"1","   61.0 "
"1","   59.6 "
"1","   70.0 "
"1","   89.0 "
"1","     18 "
"1","
"
"1","[1]"
"1"," ""Summary of Cancer Age of female probands"""
"1","
"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","   34.0 "
"1","   40.0 "
"1","   44.0 "
"1","   48.0 "
"1","   55.5 "
"1","   72.0 "
"1","
"
"1","[1]"
"1"," ""Summary of Cancer Age of male probands"""
"1","
"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","  42.00 "
"1","  49.00 "
"1","  51.00 "
"1","  54.11 "
"1","  54.00 "
"1","  75.00 "
"1","
"
"1","[1]"
"1"," ""Number of individuals with NA Cancer Age (Male): 18"""
"1","
"
"1","[1]"
"1"," ""Number of individuals with NA Cancer Age (Female): 15"""
"1","
"
"2","Warning:"
"2"," [38;5;252mRemoved 23895 rows containing non-finite outside the scale range (`stat_bin()`).[39m
"
"2","Warning:"
"2"," [38;5;252mRemoved 2 rows containing missing values or values outside the scale range (`geom_bar()`).[39m
"
