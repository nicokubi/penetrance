"0",""
"0","# Calculate error metrics at key ages"
"0","key_ages <- c(30, 50, 70)"
"0","metrics <- data.frame()"
"0",""
"0","# Check if we have the estimated curves"
"0","if (exists(""estimated_curves"") && length(estimated_curves) > 0) {"
"0","  for (name in names(all_params)) {"
"0","    params <- all_params[[name]]"
"0","    size <- as.numeric(gsub(""n"", """", name))"
"0","    "
"0","    # Get the estimated curves"
"0","    est_data <- estimated_curves[[name]]"
"0","    "
"0","    for (age in key_ages) {"
"0","      if (age <= max_age) {"
"0","        # Get values at this age"
"0","        female_true <- true_pen_df$Female_True[age]"
"0","        male_true <- true_pen_df$Male_True[age]"
"0","        female_est <- est_data$Female_Est[age]"
"0","        male_est <- est_data$Male_Est[age]"
"0","        "
"0","        # Calculate absolute and relative errors"
"0","        female_abs_error <- abs(female_est - female_true)"
"0","        male_abs_error <- abs(male_est - male_true)"
"0","        female_rel_error <- female_abs_error / female_true"
"0","        male_rel_error <- male_abs_error / male_true"
"0","        "
"0","        # Add to metrics data frame"
"0","        metrics <- rbind(metrics, "
"0","                        data.frame("
"0","                          SampleSize = size,"
"0","                          Age = age,"
"0","                          Sex = ""Female"","
"0","                          TruePenetrance = female_true,"
"0","                          EstimatedPenetrance = female_est,"
"0","                          AbsoluteError = female_abs_error,"
"0","                          RelativeError = female_rel_error"
"0","                        ))"
"0","        "
"0","        metrics <- rbind(metrics, "
"0","                        data.frame("
"0","                          SampleSize = size,"
"0","                          Age = age,"
"0","                          Sex = ""Male"","
"0","                          TruePenetrance = male_true,"
"0","                          EstimatedPenetrance = male_est,"
"0","                          AbsoluteError = male_abs_error,"
"0","                          RelativeError = male_rel_error"
"0","                        ))"
"0","      }"
"0","    }"
"0","  }"
"0","} else {"
"0","  cat(""Error: estimated_curves object not found or empty. Cannot calculate metrics.\n"")"
"0","}"
"0",""
"0","# Add factor version of SampleSize for better plotting"
"0","metrics$SampleSizeFactor <- factor(metrics$SampleSize, "
"0","                                 levels = sample_sizes,"
"0","                                 ordered = TRUE)"
"0",""
"0","# Display the metrics table"
"0","knitr::kable(metrics, digits = 3, "
"0","            caption = ""Error Metrics at Key Ages"")"
